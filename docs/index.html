<script>
    const params = new URLSearchParams(location.search);
    const assetId = params.get('id');

    function outputXML(data) {
        // For browser viewing
        if (typeof document !== 'undefined' && document.contentType === 'text/html') {
            // Escape XML for HTML display
            const escaped = data
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;");
            document.body.innerHTML = `<pre>${escaped}</pre>`;
        }
        // For Roblox requests (HttpService): return raw XML string
        return data;
    }

    if (assetId) {
        fetch(`https://roblox-decal-to-image-convert.aarontheluanerd.workers.dev/?id=${assetId}`)
            .then(response => {
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.text();
            })
            .then(xml => {
                const result = outputXML(xml);
                if (typeof document !== 'undefined') {
                    document.write(result);
                    document.close();
                }
            })
            .catch(error => {
                const errorText = `<error>Proxy failed: ${error.message.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</error>`;
                const result = outputXML(errorText);
                if (typeof document !== 'undefined') {
                    document.write(result);
                    document.close();
                }
            });
    } else {
        const errorText = `<error>Missing asset ID</error>`;
        const result = outputXML(errorText);
        if (typeof document !== 'undefined') {
            document.write(result);
            document.close();
        }
    }
</script>
