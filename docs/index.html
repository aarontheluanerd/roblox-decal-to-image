<script>
    // This version works in both browser and Roblox
    const params = new URLSearchParams(location.search);
    const assetId = params.get('id');
    
    function outputJSON(data) {
        // For browser viewing
        if (typeof document !== 'undefined' && document.contentType === 'text/html') {
            document.body.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        // For Roblox requests
        return data;
    }
    
    if (assetId) {
        fetch(`https://roblox-decal-to-image-convert.aarontheluanerd.workers.dev/?id=${assetId}`)
            .then(response => {
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            })
            .then(data => {
                const result = outputJSON(data);
                if (typeof document !== 'undefined') {
                    document.write(JSON.stringify(result));
                    document.close();
                }
            })
            .catch(error => {
                const errorData = { 
                    error: "Proxy failed", 
                    details: error.message.replace(/"/g, "'") 
                };
                const result = outputJSON(errorData);
                if (typeof document !== 'undefined') {
                    document.write(JSON.stringify(result));
                    document.close();
                }
            });
    } else {
        const errorData = { error: "Missing asset ID" };
        const result = outputJSON(errorData);
        if (typeof document !== 'undefined') {
            document.write(JSON.stringify(result));
            document.close();
        }
    }
    </script>